= Micrometer JMX
Jon Schneider <jschneider@pivotal.io>
:toc:
:sectnums:
:system: jmx

Micrometer provides a hierarchical mapping to JMX, primarily as a cheap and portable way to view metrics locally. Where JMX exporting is found in production, the same metrics are generally exported to another, more purpose-fit monitoring system.

include::install.adoc[]

Micrometer also sometimes scrapes data from JMX beans for use in reporting metrics. This registry implementation is not needed for these uses. Rather, this module is strictly used to _export_ data to JMX.

include::hierarchical-name-mapping.adoc[]

== Configuring

The example below uses a `JmxMeterRegistry` to set values into JMX beans.

[source,java]
----

meterRegistry = new JmxMeterRegistry(JmxConfig.DEFAULT, Clock.SYSTEM);
counter = Counter.builder("app.counter.example.tick")
        .tags("level", "normal")
        .description("Number of info level events that made it to the logs")
        .register(meterRegistry);

counter.increment();

----

These values can be exposed to Prometheus using the https://github.com/prometheus/jmx_exporter[JMX Exporter].

An example Prometheus rule to translate the counter above might look like this:

----
rules:
  - pattern: metrics<name=appCounterExampleTick.level.normal><>Count
    name: app_counter_example_tick_normal_totals
    type: COUNTER
----

== Counters

JMX counters measure mean throughput and one-, five-, and fifteen-minute exponentially-weighted moving average throughputs.

.The JMX rendered values of the random walk counter.
image::img/jmx-counter.png[JMX-rendered counter]